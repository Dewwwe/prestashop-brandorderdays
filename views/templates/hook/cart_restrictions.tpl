<div class="cart-restrictions" data-cart-has-restricted-products="true">
  <h4>{l s='Oops! Some products in your cart are not available anymore.' d='Modules.Brandorderdays.Shop'}</h4>
  <p>{$global_message|escape:'htmlall':'UTF-8'}</p>
  
  {* <ul class="restricted-products-list">
    {foreach from=$restricted_products item=product}
      <li>
        <strong>{$product.name|escape:'htmlall':'UTF-8'}</strong>
        {if isset($product.cart_quantity)}
          <span class="product-attributes">({$product.cart_quantity|escape:'htmlall':'UTF-8'})</span>
        {/if}
        <a href="{$cart_url}?delete=1&id_product={$product.id_product}&id_product_attribute={$product.id_product_attribute|default:'0'}&token={$static_token}" 
           class="remove-from-cart"
           rel="nofollow"
           title="{l s='Remove this product from my cart' d='Modules.Brandorderdays.Shop'}">
          <i class="material-icons">delete</i>
        </a>
      </li>
    {/foreach}
  </ul> *}
  
  <div class="cart-action-buttons">
    <button id="remove-all-restricted" class="btn btn-primary">
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16.1846 5.62793C17.0004 5.62407 17.8052 5.66182 18.6455 5.68164C18.782 5.6849 18.8729 5.68401 18.9736 5.69141H18.9746C19.3188 5.71665 19.5571 5.81319 19.7227 5.94922C19.8863 6.08367 20.0209 6.29113 20.0977 6.61523C20.1365 6.77926 20.1573 6.94033 20.1738 7.11426L20.2246 7.69043C20.2436 7.87453 20.2479 8.04221 20.2637 8.29199L20.2891 8.69531L20.6885 8.75488C20.8434 8.77804 20.9997 8.79281 21.1562 8.79785H21.1865C22.1066 8.77206 22.9999 8.73453 23.9092 8.71484H23.9199C24.1066 8.70689 24.2934 8.72588 24.4746 8.77051L24.4814 8.77148C24.5605 8.78982 24.6303 8.83341 24.6816 8.89355H24.6826C24.7337 8.95347 24.7635 9.02751 24.7686 9.10449L24.7695 9.12988L24.7744 9.1543C24.7889 9.24272 24.775 9.33364 24.7354 9.41504C24.6955 9.49656 24.6311 9.5655 24.5498 9.61035L24.541 9.61426L24.5322 9.62012C24.4145 9.69116 24.3176 9.72611 24.0986 9.83398L23.8203 9.97168V10.2822C23.8203 10.7442 23.8033 11.258 23.8232 11.751C23.9391 14.6125 24.0962 17.4369 23.9902 20.2656C23.9519 21.2881 23.8823 22.3054 23.7432 23.3047C23.6741 23.8008 23.4719 24.2907 23.2529 24.8555L23.252 24.8574C23.1796 25.0465 23.0652 25.2174 22.917 25.3574H22.916C22.7678 25.4975 22.5893 25.603 22.3936 25.666L22.3857 25.6689C21.9231 25.8262 21.4481 25.9444 20.9658 26.0244C20.519 26.0809 20.0694 26.114 19.6191 26.1201H19.6016C17.7627 26.2107 15.9394 26.3173 14.1113 26.376H14.1055C13.3623 26.4073 12.6177 26.3757 11.8799 26.2812H11.8809C10.9704 26.1542 10.3186 25.8504 9.86035 25.3965C9.40155 24.9419 9.08983 24.2908 8.94531 23.3848V23.3799L8.88574 22.9902C8.8342 22.5998 8.80498 22.2064 8.79785 21.8125C8.78743 20.239 8.78014 18.6654 8.77637 17.0918L8.77539 12.3643C8.77636 11.6302 8.83793 10.9161 8.87598 10.0986L8.89648 9.65137L8.45508 9.58105C8.08353 9.52179 7.83976 9.49562 7.58008 9.43945C7.3833 9.39689 7.2893 9.33868 7.25098 9.30371C7.22585 9.28077 7.22027 9.26726 7.21973 9.2373C7.21903 9.19485 7.23168 9.16356 7.26172 9.13379C7.29613 9.09975 7.37982 9.04426 7.55273 9.02246C8.26149 8.93313 8.9786 8.90845 9.72852 8.87109C10.112 8.85184 10.4764 8.86816 10.9668 8.86816H11.5879L11.4551 8.26074C11.3905 7.96528 11.3396 7.71166 11.2812 7.46875L11.2793 7.46289C11.1905 7.11127 11.2379 6.73934 11.4121 6.41992L11.416 6.41309C11.6622 5.94461 11.9935 5.7128 12.4629 5.69727C13.0829 5.67676 13.703 5.66097 14.3232 5.64941L16.1846 5.62793ZM9.38867 10.2256C9.43346 10.9914 9.47323 13.2693 9.52441 15.666C9.57522 18.0449 9.63813 20.541 9.73047 21.7061C9.78715 22.4213 9.95399 23.1344 10.084 23.7803C10.1697 24.2054 10.3638 24.5675 10.6621 24.8398C10.9584 25.1102 11.3303 25.2674 11.7334 25.332C12.4581 25.4481 13.238 25.5683 14.0195 25.5625C15.8625 25.5489 17.7039 25.4857 19.54 25.4033C20.2711 25.3705 21.0093 25.2331 21.6768 25.1357L21.6777 25.1367C21.9081 25.1079 22.1243 25.0076 22.2949 24.8496V24.8486C22.4597 24.6958 22.5719 24.4965 22.6201 24.2773L22.6221 24.2783C22.7072 23.9372 22.8503 23.4856 22.9014 23.0498C23.1711 20.7479 23.1148 18.4438 23.0449 16.1787C22.9898 14.3943 22.925 12.6091 22.8643 10.8271C22.8585 10.661 22.8467 10.4856 22.8398 10.3564L22.8145 9.88965L22.3477 9.88281C18.0314 9.82038 14.2485 9.76029 9.89551 9.69727L9.35742 9.68945L9.38867 10.2256ZM19.3643 6.4375L18.8809 6.42188C16.7777 6.35189 14.6733 6.27428 12.54 6.48145L12.0879 6.52539V8.81445L12.5703 8.83105C14.6982 8.9074 16.7859 8.90485 18.8877 8.80762L19.3643 8.78516V6.4375Z" fill="#fff" stroke="#fff"/>
<path d="M18.6416 12.4185H18.6611C18.6679 12.4263 18.6832 12.4465 18.6973 12.4907L18.6992 12.4966C18.7276 12.5821 18.7438 12.6708 18.749 12.7603C18.7664 13.1414 18.7838 13.5225 18.8018 13.9038L18.8027 13.9058V13.9243C18.8528 14.9809 18.9049 16.0654 18.9268 17.1343C18.9516 18.3458 18.9415 19.5772 18.9326 20.7759L18.9277 21.5181C18.9231 21.8172 18.8948 22.1158 18.8438 22.4106L18.8418 22.4194L18.8408 22.4282C18.836 22.4635 18.8182 22.4968 18.79 22.522C18.7617 22.5469 18.7251 22.5619 18.6865 22.563H18.6758L18.665 22.564C18.6567 22.5645 18.6495 22.5649 18.6436 22.5649H18.6348C18.5927 22.5657 18.5522 22.5514 18.5205 22.5259C18.5048 22.5132 18.4914 22.4984 18.4814 22.4819L18.4609 22.4282L18.459 22.4194L18.4248 22.229C18.3957 22.0376 18.3832 21.8438 18.3887 21.6499V21.6431C18.4048 20.564 18.4293 19.476 18.4521 18.4214C18.4539 18.3558 18.5756 13.9816 18.5918 12.6528V12.647C18.5918 12.5921 18.5937 12.5372 18.5996 12.4829C18.6041 12.4488 18.6117 12.4304 18.6152 12.4224C18.6219 12.4205 18.6313 12.4193 18.6416 12.4185Z" fill="#fff" stroke="#fff"/>
<path d="M13.9805 12.5039C13.9915 12.5124 13.9994 12.5237 14.0059 12.5352C14.0327 12.6159 14.0487 12.6995 14.0527 12.7842V12.8877L14.0518 12.8975C14.0343 14.0454 14.0133 15.1878 13.9902 16.3975L13.9688 17.5146V17.5342L13.9873 18.4736L14.0469 21.7021V21.709C14.052 21.8845 14.0392 22.0602 14.0078 22.2334C13.9851 22.3484 13.9403 22.4169 13.9053 22.4512C13.8735 22.4822 13.844 22.4917 13.8135 22.4922H13.8125C13.7881 22.4922 13.76 22.4852 13.7246 22.4531C13.6858 22.4179 13.6349 22.3479 13.6006 22.2275L13.5996 22.2246L13.5615 22.0469C13.5533 21.9887 13.549 21.93 13.5488 21.8711L13.5625 20.6328C13.5762 19.2845 13.5896 17.8965 13.6299 16.5312V16.5303C13.6577 15.5774 13.7219 14.6102 13.7852 13.6641C13.8035 13.3897 13.8216 13.1207 13.8389 12.8516H13.8398V12.8398C13.8442 12.7328 13.8725 12.6282 13.9209 12.5322L13.9541 12.5039C13.9592 12.5013 13.9653 12.5009 13.9707 12.499C13.9738 12.5009 13.9776 12.5017 13.9805 12.5039Z" fill="#fff" stroke="#fff"/>
</svg>
      {l s='Remove all' d='Modules.Brandorderdays.Shop'}
    </button>
  </div>

  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
      // Get the remove all button
      var removeAllBtn = document.getElementById('remove-all-restricted');
      
      // Add click event
      removeAllBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Show loading state
        removeAllBtn.disabled = true;
        removeAllBtn.innerHTML = '<i class="material-icons">hourglass_empty</i> {l s='Removing...' d='Modules.Brandorderdays.Shop'}';
        
        // Array of products to remove
        var productsToRemove = [
          {foreach from=$restricted_products item=product}
            {
              id_product: {$product.id_product},
              id_product_attribute: {$product.id_product_attribute|default:'0'}
            }{if !$product@last},{/if}
          {/foreach}
        ];
        
        // Function to remove products one by one
        function removeNextProduct(index) {
          if (index >= productsToRemove.length) {
            // All products removed, reload the page
            window.location.reload();
            return;
          }
          
          var product = productsToRemove[index];
          
          // Create the URL for removal
          var removeUrl = '{$cart_url}?delete=1&id_product=' + 
                          product.id_product + 
                          '&id_product_attribute=' + 
                          product.id_product_attribute + 
                          '&token={$static_token}';
          
          // Make AJAX request to remove the product
          fetch(removeUrl, {
            method: 'GET',
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            }
          })
          .then(function(response) {
            // Move to the next product regardless of success
            removeNextProduct(index + 1);
          })
          .catch(function(error) {
            console.error('Error removing product:', error);
            // Try to continue with next product anyway
            removeNextProduct(index + 1);
          });
        }
        
        // Start removing products
        removeNextProduct(0);
      });
    });
  </script>
</div>
